<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒØ´ÙˆÙ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† - Ù„Ø¬Ù†Ø© 26 - Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</title>
    <style>
        body {font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:20px;}
        .container {max-width:1000px; margin:auto; background:white; padding:25px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
        h1 {text-align:center; margin-bottom:5px; color:#1877f2;}
        .subtitle {text-align:center; color:#444; margin-bottom:20px; font-size:18px;}
        .search-box {width:100%; padding:16px; font-size:22px; border-radius:50px;
            border:3px solid #1877f2; margin:20px 0 0 0; text-align:center;}
        .results {margin-top:20px; max-height:500px; overflow-y:auto;}
        .voter-item {
            background:#fff; padding:15px; border-right:6px solid #28a745; border-radius:12px;
            margin:10px 0; cursor:pointer; transition:.25s; box-shadow:0 3px 10px rgba(0,0,0,0.08);}
        .voter-item:hover {background:#e8f5e8; transform:translateX(-6px);}
        .voter-name {font-size:20px; font-weight:bold;}
        .voter-serial {font-size:24px; font-weight:bold; color:#d32f2f;}
        .mic-section {text-align:center; margin:0 0 14px 0;}
        #micBtn {font-size:24px;border:none;border-radius:50%;background:#ffc107;color:#222;
            padding:15px;cursor:pointer;transition:.25s;}
        #micBtn.active {background:#ff9800;}
        #micStatus {margin-right:12px;color:#888;font-size:18px;}
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        #floatingInputBtn {
            position: fixed;
            top: 70px;
            left: 24px;
            z-index: 9999;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 58px;
            height: 58px;
            font-size: 32px;
            box-shadow:0 3px 12px rgba(0,0,0,0.17);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition:.2s;
        }
        #floatingInputBtn:hover {background: #1355af;}

        /* Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„Ø²Ø± */
        #dataStatusDot {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            box-shadow:0 0 0 1.5px #fff;
            background: #d32f2f; /* Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø£Ø­Ù…Ø± */
            border:2.5px solid #fff;
            display: block;
            z-index: 2;
            transition:.18s;
        }
        #dataStatusDot.full { background: #16c35e;}

        #inputModal {
            display: none;
            position: fixed;left:0;top:0;width:100vw;height:100vh;
            background: rgba(0,0,0,0.22);z-index:10001;
            align-items: center;justify-content: center;
        }
        #inputModalBox {
            background: white;
            padding: 28px 18px 10px 18px;
            border-radius: 12px;
            max-width:420px;
            min-width:260px;
            width:96vw;
            box-shadow:0 3px 24px rgba(0,0,0,0.19);
            display: flex;flex-direction: column;align-items: center;
        }
        #inputModalBox textarea {width:100%; min-height:180px; border-radius:8px; border:2px solid #1877f2; font-size:16px; margin-bottom:16px; padding:10px;}
        #inputModalBox button {
            background: #1877f2; color: white;
            border:none; font-size: 18px; padding:10px 40px; border-radius:9px;margin:6px 2px;
            cursor:pointer;margin-bottom:3px;
        }
        #inputModalBox button#modalClose {background:#d32f2f;}
        @media (max-width: 700px) {
          #inputModalBox {min-width:60vw;}
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .modal {display:none; position:fixed; left:0; top:0; width:100%; height:100%;
            background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center;}
        .card {width:380px; background:white; border-radius:18px; overflow:hidden;
            box-shadow:0 10px 30px rgba(0,0,0,0.5);}
        .card-header {background:#0d47a1; color:white; padding:18px; text-align:center;
            font-size:26px; font-weight:bold;}
        .voter-fullname {background:#e3f2fd; padding:20px; margin:15px;
            border-right:6px solid #1976d2; font-size:22px; font-weight:bold;}
        .big-serial {margin: 10px 15px; font-size: 32px; font-weight: 900; color: #c62828;
            text-align:center; border-right:6px solid #d32f2f; background:#ffebee; padding:15px; border-radius:12px;}
        .committee-box {background:#e8eaf6; padding:18px; margin:15px; border-right:6px solid #3f51b5; font-size:26px; font-weight:bold;}
        .place-box {background:#e8f5e9; padding:18px; margin:15px; border-right:6px solid #4caf50; font-size:22px;}
        .print-btn {background:#d32f2f; color:white; border:none; width:80%; padding:14px;
            margin:20px auto; border-radius:40px; font-size:22px; cursor:pointer;}
        @media print {
            body * {visibility:hidden;}
            #printArea, #printArea * {visibility:visible;}
            #printArea {position:absolute;left:0;top:0;width:5cm;height:2.5cm;background:white;
                padding-top:0.6cm;text-align:center; border:1px solid #000;}
            @page {size: 5cm 2.5cm;margin:0;}
        }
    </style>
</head>

<body>
<div class="container">
    <h1>Ù„Ø¬Ù†Ø© 26</h1>
    <p class="subtitle">Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØª Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙˆØ±ÙŠØ§Ù‹</p>
    <div class="mic-section">
        <button id="micBtn" title="Ø¨Ø­Ø« ØµÙˆØªÙŠ">ğŸ¤</button>
        <span id="micStatus"></span>
    </div>
    <input type="text" id="searchBox" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." onkeyup="search()">
    <div id="results" class="results"></div>
</div>

<!-- Ø²Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù… Ù…Ø¹ Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<button id="floatingInputBtn" title="Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª">
    ğŸ“‹
    <span id="dataStatusDot"></span>
</button>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
<div id="inputModal">
    <div id="inputModalBox">
        <h3 style="color:#1877f2;margin-bottom:8px;">Ø¥Ø¯Ø®Ø§Ù„/ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</h3>
        <textarea id="textInput" placeholder="Ù…Ø«Ø§Ù„: Ù¡ Ø§Ø¨ØªØ³Ø§Ù… ... Ù¢ Ø§Ø¨ØªØ³Ø§Ù… ... Ù£ ... ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø³Ø·Ø± Ø£Ùˆ Ø³Ø·ÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©"></textarea>
        <div style="display:flex; gap:10px;">
            <button onclick="loadData()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button id="modalClose">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <div class="card-header">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø§Ø®Ø¨</div>
        <div class="voter-fullname" id="mName"></div>
        <div class="big-serial" id="mSerial"></div>
        <div class="committee-box">Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©: 26</div>
        <div class="place-box">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</div>
        <button class="print-btn" onclick="printCard()">Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
</div>

<div id="printArea" style="display:none;">
    <div id="pSerialOnly" style="font-size:28px;font-weight:bold;text-align:center;margin-top:4px;"></div>
</div>

<script>
let voters = [];

// Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© Ù…Ø¹ Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø©
const floatingInputBtn = document.getElementById('floatingInputBtn');
const inputModal = document.getElementById('inputModal');
const modalCloseBtn = document.getElementById('modalClose');
const textInput = document.getElementById('textInput');
const dataStatusDot = document.getElementById('dataStatusDot');

function updateDotStatus() {
    if (textInput.value.trim()) {
        dataStatusDot.classList.add('full'); // Ø£Ø®Ø¶Ø±
    } else {
        dataStatusDot.classList.remove('full'); // Ø£Ø­Ù…Ø±
    }
}

// ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
floatingInputBtn.onclick = function() {
    inputModal.style.display = 'flex';
    updateDotStatus();
}
modalCloseBtn.onclick = function() { inputModal.style.display = 'none'; }
inputModal.addEventListener('click',function(e){
    if(e.target === inputModal) inputModal.style.display='none';
});

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‚Ø·Ø© Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„
textInput.addEventListener('input', updateDotStatus);
window.addEventListener('DOMContentLoaded', updateDotStatus);
floatingInputBtn.addEventListener('click', updateDotStatus);

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ù‡Ù†Ø¯ÙŠØ©
function fixNumbers(str) {
    const map = {"Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9"};
    return str.replace(/[Ù -Ù©]/g, d => map[d]);
}
// ØªÙˆØ­ÙŠØ¯ Ø§Ù„ÙŠØ§Ø¡ ÙˆØ§Ù„Ø£Ù„Ù Ø§Ù„Ù…Ù‚ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø¨Ø­Ø«
function normalizeName(str) {
    return str.replace(/[ÙŠÙ‰]/g, "Ù‰").replace(/\s+/g, " ").trim();
}
function extractNumberName(line) {
    line = fixNumbers(line).trim();
    if (!line) return [];
    if (line.includes("Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø³Ù…")) return [];
    if (/^\d+\s+Ù…Ù†\s+\d+/.test(line)) return [];
    if (line.includes("Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©")) return [];
    let regex = /(\d{1,5})\s+([\u0600-\u06FF]+(?:\s+[\u0600-\u06FF]+)*)(?=\s+\d{1,5}\b|$)/g;
    let matches = [...line.matchAll(regex)];
    if (!matches.length) return [];
    return matches.map(m => ({
        number: m[1],
        name: m[2].trim()
    }));
}
function loadData() {
    const text = textInput.value.trim();
    if (!text) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹!"); updateDotStatus(); return; }
    voters = [];
    const lines = text.split(/\n/);
    lines.forEach(line => {
        const recs = extractNumberName(line);
        if (recs.length) voters.push(...recs);
    });
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + voters.length + " Ù†Ø§Ø®Ø¨.");
    inputModal.style.display = 'none';
    setTimeout(() => {document.getElementById('searchBox').focus();}, 200);
    search();
    updateDotStatus();
}
function search() {
    let q = document.getElementById("searchBox").value.trim();
    let res = document.getElementById("results");
    res.innerHTML = "";
    if (!q) return;
    const normQ = normalizeName(q);
    const matched = voters.filter(v =>
        normalizeName(v.name).includes(normQ) || v.number.includes(q)
    );
    matched.forEach(v => {
        const div = document.createElement("div");
        div.className = "voter-item";
        div.innerHTML = `
            <div class="voter-name">${v.name}</div>
            <div class="voter-serial">Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: ${v.number}</div>
        `;
        div.onclick = () => showCard(v);
        res.appendChild(div);
    });
}
function showCard(v) {
    document.getElementById("mName").textContent = v.name;
    document.getElementById("mSerial").textContent = "Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: " + v.number;
    document.getElementById("pSerialOnly").textContent = v.number;
    document.getElementById("modal").style.display = "flex";
}
function printCard() {window.print();}

/* Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ */
let recognition;
let micActive = false;
try {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ar-EG';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onstart = () => {
        micActive = true;
        document.getElementById('micBtn').classList.add('active');
        document.getElementById('micStatus').textContent = "ÙŠØ³ØªÙ…Ø¹...";
        document.getElementById('searchBox').value = "";
        document.getElementById('results').innerHTML = "";
    };
    recognition.onresult = (event) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
        if (event.results.length > 0) {
            const text = event.results[0][0].transcript.trim();
            document.getElementById('searchBox').value = text;
            search();
        }
    };
    recognition.onend = () => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
    };
    recognition.onerror = (e) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "Ù„Ù… ØªÙ„ØªÙ‚Ø· Ø§Ù„ØµÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­";
    }

    document.getElementById('micBtn').addEventListener('click', function() {
        if (!micActive) recognition.start();
    });
} catch (e) {
    document.getElementById('micStatus').textContent = "ğŸ¤ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­";
}
</script>
</body>
</html>
