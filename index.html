<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒØ´ÙˆÙ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† - Ù„Ø¬Ù†Ø© 26 - Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.1/dist/tesseract.min.js"></script>

    <style>
        body {font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:20px;}
        .container {max-width:1000px; margin:auto; background:white; padding:25px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
        h1 {text-align:center; margin-bottom:5px; color:#1877f2;}
        .subtitle {text-align:center; color:#444; margin-bottom:20px; font-size:18px;}

        .upload-area {border:3px dashed #1877f2; padding:30px; text-align:center; border-radius:15px; background:#f8f9fa; margin-top:20px;}
        textarea {width:100%; height:260px; padding:12px; font-size:16px; border-radius:8px; border:2px solid #ccc;}

        .search-box {width:100%; padding:16px; font-size:22px; border-radius:50px;
            border:3px solid #1877f2; margin:20px 0 0 0; text-align:center;}

        .results {margin-top:20px; max-height:500px; overflow-y:auto;}

        .voter-item {
            background:#fff; padding:15px; border-right:6px solid #28a745; border-radius:12px;
            margin:10px 0; cursor:pointer; transition:.25s; box-shadow:0 3px 10px rgba(0,0,0,0.08);
        }
        .voter-item:hover {background:#e8f5e8; transform:translateX(-6px);}
        .voter-name {font-size:20px; font-weight:bold;}
        .voter-serial {font-size:24px; font-weight:bold; color:#d32f2f;}

        /* Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ØµÙˆØªÙŠ */
        .mic-section {text-align:center; margin:0 0 14px 0;}
        #micBtn {font-size:24px;border:none;border-radius:50%;background:#ffc107;color:#222;
            padding:15px;cursor:pointer;transition:.25s;}
        #micBtn.active {background:#ff9800;}
        #micStatus {margin-right:12px;color:#888;font-size:18px;}

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .modal {display:none; position:fixed; left:0; top:0; width:100%; height:100%;
            background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center;}

        .card {width:380px; background:white; border-radius:18px; overflow:hidden;
            box-shadow:0 10px 30px rgba(0,0,0,0.5);}

        .card-header {background:#0d47a1; color:white; padding:18px; text-align:center;
            font-size:26px; font-weight:bold;}

        .voter-fullname {background:#e3f2fd; padding:20px; margin:15px;
            border-right:6px solid #1976d2; font-size:22px; font-weight:bold;}

        .big-serial {
            margin: 10px 15px;
            font-size: 32px;
            font-weight: 900;
            color: #c62828;
            text-align:center;
            border-right:6px solid #d32f2f;
            background:#ffebee;
            padding:15px;
            border-radius:12px;
        }

        .committee-box {background:#e8eaf6; padding:18px; margin:15px;
            border-right:6px solid #3f51b5; font-size:26px; font-weight:bold;}

        .place-box {background:#e8f5e9; padding:18px; margin:15px;
            border-right:6px solid #4caf50; font-size:22px;}

        .print-btn {background:#d32f2f; color:white; border:none; width:80%; padding:14px;
            margin:20px auto; border-radius:40px; font-size:22px; cursor:pointer;}

        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø­Ø¬Ù… 5Ã—2.5 Ø³Ù… */
        @media print {
            body * {visibility:hidden;}
            #printArea, #printArea * {visibility:visible;}
            #printArea {
                position:absolute;
                left:0;
                top:0;
                width:5cm;
                height:2.5cm;
                background:white;
                padding-top:0.6cm;
                text-align:center;
                border:1px solid #000;
            }
            @page {
                size: 5cm 2.5cm;
                margin:0;
            }
        }
    </style>
</head>

<body>
<div class="container">
    <h1>Ù„Ø¬Ù†Ø© 26</h1>
    <p class="subtitle">Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø®Ø§Ù… Ù…Ù† PDF Ø£Ùˆ Word â€” Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ³ØªØ®Ø±Ø¬ ÙƒÙ„ Ù†Ø§Ø®Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</p>

    <div class="upload-area">
        <p>Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ù† PDF Ø£Ùˆ Word</p>
        <textarea id="textInput" placeholder="Ù…Ø«Ø§Ù„: Ù¡ Ø§Ø¨ØªØ³Ø§Ù… ... Ù¢ Ø§Ø¨ØªØ³Ø§Ù… ... Ù£ ... ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø³Ø·Ø± Ø£Ùˆ Ø³Ø·ÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©"></textarea>
        <button onclick="loadData()" style="margin-top:10px; padding:12px 30px; background:#1877f2; color:white; border:none; border-radius:8px; cursor:pointer;">
            ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
    </div>

    <!-- Ø²Ø± Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ØµÙˆØªÙŠ -->
    <div class="mic-section">
        <button id="micBtn" title="Ø¨Ø­Ø« ØµÙˆØªÙŠ">ğŸ¤</button>
        <span id="micStatus"></span>
    </div>

    <input type="text" id="searchBox" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." onkeyup="search()">
    <div id="results" class="results"></div>
</div>

<!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <div class="card-header">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø§Ø®Ø¨</div>
        <div class="voter-fullname" id="mName"></div>
        <div class="big-serial" id="mSerial"></div>
        <div class="committee-box">Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©: 26</div>
        <div class="place-box">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</div>
        <button class="print-btn" onclick="printCard()">Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
</div>

<!-- Ø¬Ø²Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· -->
<div id="printArea" style="display:none;">
    <div id="pSerialOnly" style="
        font-size:28px;
        font-weight:bold;
        text-align:center;
        margin-top:4px;
    "></div>
</div>

<script>
let voters = [];

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ù‡Ù†Ø¯ÙŠØ©
function fixNumbers(str) {
    const map = {"Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9"};
    return str.replace(/[Ù -Ù©]/g, d => map[d]);
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙ„ (Ø±Ù‚Ù… + Ø§Ø³Ù…) Ù…Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„ÙˆØ§Ø­Ø¯
function extractNumberName(line) {
    line = fixNumbers(line).trim();
    if (!line) return [];

    if (line.includes("Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø³Ù…")) return [];
    if (/^\d+\s+Ù…Ù†\s+\d+/.test(line)) return [];
    if (line.includes("Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©")) return [];

    let regex = /(\d{1,5})\s+([\u0600-\u06FF]+(?:\s+[\u0600-\u06FF]+)*)(?=\s+\d{1,5}\b|$)/g;
    let matches = [...line.matchAll(regex)];
    if (!matches.length) return [];

    return matches.map(m => ({
        number: m[1],
        name: m[2].trim()
    }));
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ ÙƒØ§Ù…Ù„
function loadData() {
    const text = document.getElementById("textInput").value.trim();
    if (!text) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹!"); return; }
    voters = [];
    const lines = text.split(/\n/);
    lines.forEach(line => {
        const recs = extractNumberName(line);
        if (recs.length) voters.push(...recs);
    });
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + voters.length + " Ù†Ø§Ø®Ø¨.");
    search();
}

// Ø§Ù„Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function search() {
    let q = document.getElementById("searchBox").value.trim();
    let res = document.getElementById("results");
    res.innerHTML = "";
    const matched = voters.filter(v =>
        v.name.includes(q) || v.number.includes(q)
    );
    matched.forEach(v => {
        const div = document.createElement("div");
        div.className = "voter-item";
        div.innerHTML = `
            <div class="voter-name">${v.name}</div>
            <div class="voter-serial">Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: ${v.number}</div>
        `;
        div.onclick = () => showCard(v);
        res.appendChild(div);
    });
}

// ÙØªØ­ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
function showCard(v) {
    document.getElementById("mName").textContent = v.name;
    document.getElementById("mSerial").textContent = "Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: " + v.number;
    document.getElementById("pSerialOnly").textContent = v.number;
    document.getElementById("modal").style.display = "flex";
}

// Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
function printCard() {
    window.print();
}

/* Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ */
let recognition;
let micActive = false;
try {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ar-EG';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onstart = () => {
        micActive = true;
        document.getElementById('micBtn').classList.add('active');
        document.getElementById('micStatus').textContent = "ÙŠØ³ØªÙ…Ø¹...";
    };
    recognition.onresult = (event) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
        if (event.results.length > 0) {
            const text = event.results[0][0].transcript.trim();
            document.getElementById('searchBox').value = text;
            search();
        }
    };
    recognition.onend = () => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
    };
    recognition.onerror = (e) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "Ù„Ù… ØªÙ„ØªÙ‚Ø· Ø§Ù„ØµÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­";
    }

    document.getElementById('micBtn').addEventListener('click', function() {
        if (!micActive) recognition.start();
    });
} catch (e) {
    document.getElementById('micStatus').textContent = "ğŸ¤ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­";
}
</script>
</body>
</html>
