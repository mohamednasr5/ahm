<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª 2025</title>
<style>
body {font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:20px;}
.container {max-width:1000px; margin:auto; background:white; padding:25px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
h1 {text-align:center; margin-bottom:5px; color:#1877f2;letter-spacing:1px;font-size:38px;}
.subtitle {text-align:center; color:#444; margin-bottom:20px; font-size:18px;}
.search-box {width:100%; padding:16px; font-size:22px; border-radius:50px;
    border:3px solid #1877f2; margin:20px 0 0 0; text-align:center;}
.results {margin-top:20px; max-height:500px; overflow-y:auto;}
.voter-item {
    background:#fff; padding:15px; border-right:6px solid #28a745; border-radius:12px;
    margin:10px 0; cursor:pointer; transition:.25s; box-shadow:0 3px 10px rgba(0,0,0,0.08);}
.voter-item:hover {background:#e8f5e8; transform:translateX(-6px);}
.voter-name {font-size:20px; font-weight:bold;}
.voter-serial {font-size:24px; font-weight:bold; color:#d32f2f;}
.mic-section {text-align:center; margin:0 0 14px 0;}
#micBtn {font-size:24px;border:none;border-radius:50%;background:#ffc107;color:#222;
    padding:15px;cursor:pointer;transition:.25s;}
#micBtn.active {background:#ff9800;}
#micStatus {margin-right:12px;color:#888;font-size:18px;}
#floatingInputBtn {
    position: fixed;
    top: 70px;
    left: 24px;
    z-index: 9999;
    background: #1877f2;
    color: white;
    border: none;
    border-radius: 50%;
    width: 58px;
    height: 58px;
    font-size: 32px;
    box-shadow:0 3px 12px rgba(0,0,0,0.17);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition:.2s;
}
#floatingInputBtn:hover {background: #1355af;}
#dataStatusDot {
    position: absolute;
    top: 8px;
    left: 8px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    box-shadow:0 0 0 1.5px #fff;
    background: #d32f2f;
    border:2.5px solid #fff;
    display: block;
    z-index: 2;
    transition:.18s;
}
#dataStatusDot.full { background: #16c35e;}
#inputModal {
    display: none;
    position: fixed;left:0;top:0;width:100vw;height:100vh;
    background: rgba(0,0,0,0.22);z-index:10001;
    align-items: center;justify-content: center;
}
#inputModalBox {
    background: white;
    padding: 28px 18px 10px 18px;
    border-radius: 12px;
    max-width:420px;
    min-width:260px;
    width:96vw;
    box-shadow:0 3px 24px rgba(0,0,0,0.19);
    display: flex;flex-direction: column;align-items: center;
}
#inputModalBox textarea {width:100%; min-height:180px; border-radius:8px; border:2px solid #1877f2; font-size:16px; margin-bottom:16px; padding:10px;}
#inputModalBox button {
    background: #1877f2; color: white;
    border:none; font-size: 18px; padding:10px 22px; border-radius:9px;margin:6px 2px;
    cursor:pointer;margin-bottom:3px;
}
#inputModalBox button#modalClose {background:#d32f2f;}
@media (max-width: 700px) {
  #inputModalBox {min-width:60vw;}
}
/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© Ù…ØªØ·ÙˆØ±Ø© */
.modal {display:none; position:fixed; left:0; top:0; width:100%; height:100%;
    background:rgba(0,0,0,0.89); z-index:10000; justify-content:center; align-items:center;}
.card {width:370px; background:white; border-radius:18px; overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,0.4); display:flex; flex-direction:column;align-items:center;}

.card-header {
    background:white; color:#1976d2; padding:25px 10px 8px 10px; text-align:center;
    font-size:28px; font-weight:bold; border-bottom: none;
    border-right:6px solid #1976d2;margin-bottom:0;
}
.big-serial {
    font-size:38px;
    font-weight:900;
    color: #c62828;
    border-right:8px solid #d32f2f;
    background:#ffe4e4;
    padding:18px 18px 17px 18px;
    border-radius:15px;
    margin:12px 0 18px 0;
    letter-spacing:2px;
    text-align:center;
    width: 80%;
}
.print-btn {background:#d32f2f; color:white; border:none; width:80%; padding:14px;
    margin:18px auto 18px auto; border-radius:40px; font-size:23px; cursor:pointer;}
@media print {
    body * {visibility:hidden;}
    #printArea, #printArea * {visibility:visible;}
    #printArea {position:absolute;left:0;top:0;width:5cm;height:2.5cm;background:white;
        padding-top:0.6cm;text-align:center; border:1px solid #000;}
    @page {size: 5cm 2.5cm;margin:0;}
}
</style>
</head>
<body>
<div class="container">
    <h1>Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª 2025</h1>
    <p class="subtitle">Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØª Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙˆØ±ÙŠØ§Ù‹</p>
    <div class="mic-section">
        <button id="micBtn" title="Ø¨Ø­Ø« ØµÙˆØªÙŠ">ğŸ¤</button>
        <span id="micStatus"></span>
    </div>
    <input type="text" id="searchBox" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." onkeyup="search()">
    <div id="results" class="results"></div>
    <div style="margin-top:36px;text-align:center;color:#777;font-size:18px;">
        ØªÙ… Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨ÙƒÙ„ Ø­Ø¨ Ù…Ù† Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³
        <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank"
           style="color:#1877f2; font-weight:bold; text-decoration:none; transition:.15s;">
            Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯
        </a>
    </div>
</div>
<button id="floatingInputBtn" title="Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª">
    ğŸ“‹
    <span id="dataStatusDot"></span>
</button>
<div id="inputModal">
    <div id="inputModalBox">
        <h3 style="color:#1877f2;margin-bottom:8px;">Ø¥Ø¯Ø®Ø§Ù„/ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</h3>
        <textarea id="textInput" placeholder="Ù…Ø«Ø§Ù„: Ù¡ Ø§Ø¨ØªØ³Ø§Ù… ... Ù¢ Ø§Ø¨ØªØ³Ø§Ù… ... Ù£ ... ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø³Ø·Ø± Ø£Ùˆ Ø³Ø·ÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©"></textarea>
        <div style="display:flex; gap:10px;">
            <button onclick="loadData()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button onclick="getFromUrl()">Ø¬Ù„Ø¨ Ù…Ù† Ø±Ø§Ø¨Ø·</button>
            <button id="modalClose">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div style="color:#b99;font-size:12px; margin-top:12px; text-align:center;">
            ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ù„Ø¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø£ÙŠ Ø±Ø§Ø¨Ø· txt.
        </div>
    </div>
</div>
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <div class="card-header" id="modalName"></div>
        <div class="big-serial" id="modalSerial"></div>
        <button class="print-btn" onclick="printCard()">Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
</div>
<div id="printArea" style="display:none;">
    <div id="pSerialOnly" style="font-size:28px;font-weight:bold;text-align:center;margin-top:4px;"></div>
</div>
<script>
//--------------- ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø±Ø§Ø¨Ø· ---------------//
const AUTOLOAD_URL = "https://raw.githubusercontent.com/mohamednasr5/ahm/refs/heads/main/00.txt";
window.addEventListener('DOMContentLoaded', () => {
    fetch(AUTOLOAD_URL)
        .then(resp => resp.ok ? resp.text() : Promise.reject())
        .then(text => {
            document.getElementById('textInput').value = text.trim();
            loadData();
            updateDotStatus();
        });
});

let voters = [];
const floatingInputBtn = document.getElementById('floatingInputBtn');
const inputModal = document.getElementById('inputModal');
const modalCloseBtn = document.getElementById('modalClose');
const textInput = document.getElementById('textInput');
const dataStatusDot = document.getElementById('dataStatusDot');

function updateDotStatus() {
    if (textInput.value.trim()) dataStatusDot.classList.add('full');
    else dataStatusDot.classList.remove('full');
}
floatingInputBtn.onclick = function() {
    inputModal.style.display = 'flex';
    updateDotStatus();
}
modalCloseBtn.onclick = function() { inputModal.style.display = 'none'; }
inputModal.addEventListener('click',function(e){
    if(e.target === inputModal) inputModal.style.display='none';
});
textInput.addEventListener('input', updateDotStatus);
floatingInputBtn.addEventListener('click', updateDotStatus);
// ØªØ­Ù…ÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ø£Ùˆ Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ù†Øµ Ù…Ù† Ø±Ø§Ø¨Ø· Ø¢Ø®Ø±
function getFromUrl() {
    let url = prompt("Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§:");
    if (!url) return;
    fetch(url)
        .then(resp => resp.ok ? resp.text() : Promise.reject("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ"))
        .then(text => {
            textInput.value = text.trim();
            updateDotStatus();
            alert("ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        })
        .catch(() => alert("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¹Ù…Ù„ ÙˆØ¨Ù‡ Ù†Øµ ÙˆØ§Ø¶Ø­."));
}
function fixNumbers(str) {
    const map = {"Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9"};
    return str.replace(/[Ù -Ù©]/g, d => map[d]);
}
function normalizeName(str) {
    return str.replace(/[ÙŠÙ‰]/g, "Ù‰").replace(/\s+/g, " ").trim();
}
function extractNumberName(line) {
    line = fixNumbers(line).trim();
    if (!line) return [];
    if (line.includes("Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø³Ù…")) return [];
    if (/^\d+\s+Ù…Ù†\s+\d+/.test(line)) return [];
    if (line.includes("Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©")) return [];
    let regex = /(\d{1,5})\s+([\u0600-\u06FF]+(?:\s+[\u0600-\u06FF]+)*)(?=\s+\d{1,5}\b|$)/g;
    let matches = [...line.matchAll(regex)];
    if (!matches.length) return [];
    return matches.map(m => ({
        number: m[1],
        name: m[2].trim()
    }));
}
function loadData() {
    const text = textInput.value.trim();
    if (!text) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹!"); updateDotStatus(); return; }
    voters = [];
    const lines = text.split(/\n/);
    lines.forEach(line => {
        const recs = extractNumberName(line);
        if (recs.length) voters.push(...recs);
    });
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + voters.length + " Ù†Ø§Ø®Ø¨.");
    inputModal.style.display = 'none';
    setTimeout(() => {document.getElementById('searchBox').focus();}, 200);
    search();
    updateDotStatus();
}
//--- Levenshtein Distance (Ø¨Ø­Ø« Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ + Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ)---//
function levenshtein(a, b) {
    a = a || ""; b = b || "";
    const m = a.length, n = b.length;
    if (!m) return n; if (!n) return m;
    let v0 = new Array(n + 1), v1 = new Array(n + 1);
    for (let i = 0; i <= n; i++) v0[i] = i;
    for (let i = 0; i < m; i++) {
        v1[0] = i + 1;
        for (let j = 0; j < n; j++)
            v1[j + 1] = Math.min(v1[j] + 1, v0[j + 1] + 1, v0[j] + (a[i] === b[j] ? 0 : 1));
        [v0, v1] = [v1, v0];
    }
    return v0[n];
}
function smartMatch(query, name) {
    query = normalizeName(query); name = normalizeName(name);
    if (!query) return false;
    // Ø£ÙˆÙ„Ø§: Ù…Ù‚Ø§Ø±Ù†Ø© ØªÙ‚Ù„ÙŠØ¯ÙŠØ© (Ø£ÙˆÙ„ Ø§Ù„Ø§Ø³Ù…) ÙƒÙ…Ø§ Ø§Ù„Ø³Ø§Ø¨Ù‚
    const minLen = Math.min(query.length, name.length);
    const dist = levenshtein(query, name.slice(0, query.length));
    if (minLen >= 3 && dist <= 2) return true;
    // Ø«Ø§Ù†ÙŠØ§Ù‹: Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ (Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ)
    const qWords = query.split(" ");
    const nameWords = name.split(" ");
    // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø£Ùˆ Ù†Ù‚Øµ ÙÙŠ Ø£ÙˆÙ„ Ø­Ø±Ù Ø£Ùˆ ÙƒÙ„Ù…Ø©ØŒ Ù†Ù‚Ø§Ø±Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©
    for(let shift=1; shift<Math.min(3, nameWords.length - qWords.length + 2); shift++) {
        // Ù‡Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ø¨ØªØ¯Ø§Ø¡Ù‹ Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø§Ù„Ø«Ø§Ù„Ø«Ø© ÙŠØ·Ø§Ø¨Ù‚ ØªÙ‚Ø±ÙŠØ¨ÙŠØ§Ù‹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ØŸ
        let subName = nameWords.slice(shift, shift+qWords.length).join(" ");
        if (subName && levenshtein(query, subName) <= 2) return true;
    }
    // ÙƒØ°Ù„Ùƒ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ±Ø§Ø¡ Ø¨Ø¹Ø¶Ù‡Ø§ Ù…ØªÙ‚Ø§Ø±Ø¨Ø© ÙÙŠ Ø§Ù„ØªÙ‡Ø¬ÙŠ 
    for(let i=0; i<=nameWords.length-qWords.length; i++) {
        let subName = nameWords.slice(i,i+qWords.length).join(" ");
        if (levenshtein(query, subName) <= 2) return true;
    }
    // ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø©
    return nameWords.some(word => levenshtein(query, word) <= 1);
}
function search() {
    let q = document.getElementById("searchBox").value.trim();
    let res = document.getElementById("results");
    res.innerHTML = "";
    if (!q) return;
    const normQ = normalizeName(q);
    const scored = voters.map(v => {
        const score =
            smartMatch(normQ, v.name) ? 0 :
            levenshtein(normQ, normalizeName(v.name));
        return {v, score};
    })
    .sort((a,b) => a.score - b.score)
    .filter(a => a.score <= 2 || smartMatch(normQ, a.v.name))
    .slice(0, 15);

    scored.forEach(obj => {
        const v = obj.v;
        const div = document.createElement("div");
        div.className = "voter-item";
        div.innerHTML = `
            <div class="voter-name">${v.name}</div>
            <div class="voter-serial">Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: ${v.number}</div>
        `;
        div.onclick = () => showCard(v);
        res.appendChild(div);
    });
}
function showCard(v) {
    document.getElementById("modalName").textContent = v.name;
    document.getElementById("modalSerial").textContent = v.number;
    document.getElementById("pSerialOnly").textContent = v.number;
    document.getElementById("modal").style.display = "flex";
}
function printCard() {window.print();}
let recognition;
let micActive = false;
try {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ar-EG';
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.onstart = () => {
        micActive = true;
        document.getElementById('micBtn').classList.add('active');
        document.getElementById('micStatus').textContent = "ÙŠØ³ØªÙ…Ø¹...";
        document.getElementById('searchBox').value = "";
        document.getElementById('results').innerHTML = "";
    };
    recognition.onresult = (event) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
        if (event.results.length > 0) {
            const text = event.results[0][0].transcript.trim();
            document.getElementById('searchBox').value = text;
            search();
        }
    };
    recognition.onend = () => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "";
    };
    recognition.onerror = (e) => {
        micActive = false;
        document.getElementById('micBtn').classList.remove('active');
        document.getElementById('micStatus').textContent = "Ù„Ù… ØªÙ„ØªÙ‚Ø· Ø§Ù„ØµÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­";
    }
    document.getElementById('micBtn').addEventListener('click', function() {
        if (!micActive) recognition.start();
    });
} catch (e) {
    document.getElementById('micStatus').textContent = "ğŸ¤ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­";
}
</script>
</body>
</html>
