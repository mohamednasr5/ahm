<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كشوف الناخبين - لجنة 26 - مدرسة الأحمدية</title>

    <style>
        body {font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:20px;}
        .container {max-width:1000px; margin:auto; background:white; padding:25px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
        h1 {text-align:center; margin-bottom:5px; color:#1877f2;}
        .subtitle {text-align:center; color:#444; margin-bottom:20px; font-size:18px;}

        .upload-area {border:3px dashed #1877f2; padding:30px; text-align:center; border-radius:15px; background:#f8f9fa; margin-top:20px;}
        textarea {width:100%; height:260px; padding:12px; font-size:16px; border-radius:8px; border:2px solid #ccc;}

        .search-box {width:100%; padding:16px; font-size:22px; border-radius:50px;
            border:3px solid #1877f2; margin:20px 0; text-align:center;}

        .results {margin-top:20px; max-height:500px; overflow-y:auto;}

        .voter-item {
            background:#fff; padding:15px; border-right:6px solid #28a745; border-radius:12px;
            margin:10px 0; cursor:pointer; transition:.25s; box-shadow:0 3px 10px rgba(0,0,0,0.08);
        }
        .voter-item:hover {background:#e8f5e8; transform:translateX(-6px);}

        .voter-name {font-size:20px; font-weight:bold;}
        .voter-serial {font-size:24px; font-weight:bold; color:#d32f2f;}

        /* البطاقة العائمة */
        .modal {display:none; position:fixed; left:0; top:0; width:100%; height:100%;
            background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center;}

        .card {width:380px; background:white; border-radius:18px; overflow:hidden;
            box-shadow:0 10px 30px rgba(0,0,0,0.5);}

        .card-header {background:#0d47a1; color:white; padding:18px; text-align:center;
            font-size:26px; font-weight:bold;}

        .voter-fullname {background:#e3f2fd; padding:20px; margin:15px;
            border-right:6px solid #1976d2; font-size:22px; font-weight:bold;}

        .big-serial {
            margin: 10px 15px;
            font-size: 32px;
            font-weight: 900;
            color: #c62828;
            text-align:center;
            border-right:6px solid #d32f2f;
            background:#ffebee;
            padding:15px;
            border-radius:12px;
        }

        .committee-box {background:#e8eaf6; padding:18px; margin:15px;
            border-right:6px solid #3f51b5; font-size:26px; font-weight:bold;}

        .place-box {background:#e8f5e9; padding:18px; margin:15px;
            border-right:6px solid #4caf50; font-size:22px;}

        .print-btn {background:#d32f2f; color:white; border:none; width:80%; padding:14px;
            margin:20px auto; border-radius:40px; font-size:22px; cursor:pointer;}

        /* الطباعة بحجم 5×2.5 سم */
        @media print {
            body * {visibility:hidden;}

            #printArea, #printArea * {
                visibility:visible;
            }

            #printArea {
                position:absolute;
                left:0;
                top:0;
                width:5cm;
                height:2.5cm;
                background:white;
                padding-top:0.6cm;
                text-align:center;
                border:1px solid #000;
            }

            @page {
                size: 5cm 2.5cm;
                margin:0;
            }
        }
    </style>

</head>

<body>

<div class="container">
    <h1>لجنة 26</h1>
    <p class="subtitle">الصق النص الخام من PDF أو Word — النظام يستخرج كل ناخب تلقائيًا</p>

    <div class="upload-area">
        <p>الصق النص هنا كما هو من PDF أو Word</p>
        <textarea id="textInput" placeholder="مثال: ١ ابتسام ... ٢ ابتسام ... ٣ ... في نفس السطر أو سطور متعددة"></textarea>
        <button onclick="loadData()" style="margin-top:10px; padding:12px 30px; background:#1877f2; color:white; border:none; border-radius:8px; cursor:pointer;">
            تحميل البيانات
        </button>
    </div>

    <input type="text" id="searchBox" class="search-box" placeholder="ابحث بالاسم أو الرقم..." onkeyup="search()">

    <div id="results" class="results"></div>
</div>

<!-- البطاقة -->
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <div class="card-header">بطاقة الناخب</div>

        <div class="voter-fullname" id="mName"></div>

        <div class="big-serial" id="mSerial"></div>

        <div class="committee-box">رقم اللجنة: 26</div>
        <div class="place-box">مدرسة الأحمدية</div>

        <button class="print-btn" onclick="printCard()">طباعة</button>
    </div>
</div>

<!-- جزء الطباعة فقط -->
<div id="printArea" style="display:none;">
    <div id="pSerialOnly" style="
        font-size:28px;
        font-weight:bold;
        text-align:center;
        margin-top:4px;
    "></div>
</div>

<script>
let voters = [];

// تحويل الأرقام العربية للهندية
function fixNumbers(str) {
    const map = {"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"};
    return str.replace(/[٠-٩]/g, d => map[d]);
}

// استخراج كل (رقم + اسم) من السطر الواحد
function extractNumberName(line) {
    line = fixNumbers(line).trim();
    if (!line) return [];

    if (line.includes("مسلسل السم")) return [];
    if (/^\d+\s+من\s+\d+/.test(line)) return [];
    if (line.includes("رقم اللجنة")) return [];

    let regex = /(\d{1,5})\s+([\u0600-\u06FF]+(?:\s+[\u0600-\u06FF]+)*)(?=\s+\d{1,5}\b|$)/g;
    let matches = [...line.matchAll(regex)];
    if (!matches.length) return [];

    return matches.map(m => ({
        number: m[1],
        name: m[2].trim()
    }));
}

// تحميل النص كامل
function loadData() {
    const text = document.getElementById("textInput").value.trim();
    if (!text) { alert("أدخل النص أولاً!"); return; }

    voters = [];
    const lines = text.split(/\n/);

    lines.forEach(line => {
        const recs = extractNumberName(line);
        if (recs.length) voters.push(...recs);
    });

    alert("تم تحميل " + voters.length + " ناخب.");
    search();
}

// البحث وعرض النتائج
function search() {
    let q = document.getElementById("searchBox").value.trim();
    let res = document.getElementById("results");
    res.innerHTML = "";

    const matched = voters.filter(v =>
        v.name.includes(q) || v.number.includes(q)
    );

    matched.forEach(v => {
        const div = document.createElement("div");
        div.className = "voter-item";
        div.innerHTML = `
            <div class="voter-name">${v.name}</div>
            <div class="voter-serial">رقم الكشف: ${v.number}</div>
        `;
        div.onclick = () => showCard(v);
        res.appendChild(div);
    });
}

// فتح البطاقة العائمة
function showCard(v) {
    document.getElementById("mName").textContent = v.name;
    document.getElementById("mSerial").textContent = "رقم الكشف: " + v.number;

    document.getElementById("pSerialOnly").textContent = v.number;

    document.getElementById("modal").style.display = "flex";
}

// الطباعة
function printCard() {
    window.print();
}
</script>

</body>
</html>
